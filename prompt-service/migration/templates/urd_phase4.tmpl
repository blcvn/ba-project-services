# Phase 4: URD Detail 

### 1 Use Case Overview — Tổng quan Use Case

{{range .UseCases}}
|     |     |
| --- | --- |
| **Vai trò** | BA, AI |
| **Quy mô** | `L` `M` `S` |

| Trường | Nội dung |
| --- | --- |
| Use Case ID | {{.ID}} |
| Use Case Name | {{.Summary}} |
| Actor | {{index .Metadata "actor"}} |
| Precondition | {{index .Metadata "precondition"}} |
| Postcondition | {{index .Metadata "postcondition"}} |
| Trigger | {{index .Metadata "trigger"}} |
| Liên kết US | {{.SourceID}} |

{{end}}

---

### 2 Main Flow + Alternative + Exception

#### Main Flow (Happy Path)

{{range $index, $step := .flows_main}}{{add $index 1}}. {{$step}}
{{end}}

#### Alternative Flows

{{range $index, $flow := .flows_alternative}}**Alt {{add $index 1}}**: {{$flow}}
{{end}}

#### Exception / Error Flows

{{range $index, $flow := .flows_exception}}**Exception {{add $index 1}}**: {{$flow}}
{{end}}

---

### 3 Detail Flow Diagram & Description — Sơ đồ & Mô tả luồng chi tiết

```mermaid
{{.diagram_sequence}}
```

#### Mô tả chi tiết

| Bước | Component | Hành động | Input | Output | Lỗi có thể |
| --- | --- | --- | --- | --- | --- |
{{range $index, $step := .flow_description}}| {{add $index 1}} | {{$step.component}} | {{$step.action}} | {{$step.input}} | {{$step.output}} | {{$step.errors}} |
{{end}}

---

---

### 4 System Overview — Mô hình cấu phần

```mermaid
{{.diagram_system}}
```

---

### 5 API Specification — Đặc tả API

{{range .apis}}
| Trường | Nội dung |
| --- | --- |
| Endpoint | {{index . "endpoint"}} |
| Method | {{index . "method"}} |
| Authentication | {{index . "auth"}} |
| Request Body | `<pre>{{index . "request"}}</pre>` |
| Response 200 | `<pre>{{index . "response_ok"}}</pre>` |
| Response 400 | `<pre>{{index . "response_err"}}</pre>` |
| Response 500 | `{"error": "INTERNAL_ERROR"}` |
| Rate Limit | {{index . "rate_limit"}} |

<br/>
{{end}}

---

### 6 Notification Specifications — Đặc tả thông báo

{{range .notifications}}
| Trường | Nội dung |
| --- | --- |
| Type | {{index . "type"}} |
| Trigger | {{index . "trigger"}} |
| Recipient | {{index . "recipient"}} |
| Template | {{index . "template"}} |
| Channels | {{index . "channels"}} |

<br/>
{{end}}

---

### 7 State Diagram — Sơ đồ trạng thái

```mermaid
{{.diagram_state}}
```

#### Bảng Chuyển Trạng Thái

| Trạng thái hiện tại | Sự kiện / Hành động | Trạng thái mới | Điều kiện |
| --- | --- | --- | --- |
{{range $index, $trans := .state_transitions}}| {{$trans.current}} | {{$trans.event}} | {{$trans.next}} | {{$trans.condition}} |
{{end}}


---

### 8 ERD & Data Dictionary — ERD & Từ điển dữ liệu

#### Data Dictionary

{{range .entities}}
**Entity: {{index . "name"}}**

| Field | Type | Required | Description | Validation |
| --- | --- | --- | --- | --- |
{{range $field := index . "fields"}}| {{$field.name}} | {{$field.type}} | {{$field.required}} | {{$field.description}} | {{$field.validation}} |
{{end}}

<br/>
{{end}}

---

### 9 Data Migration Plan — Kế hoạch chuyển đổi dữ liệu

{{.migration_plan}}
